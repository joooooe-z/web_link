<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¢é˜…é“¾æ¥ç®¡ç† | Onerway</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css">
    <link rel="stylesheet" href="../css/lite-main.css">
    <link rel="stylesheet" href="../css/new-nav.css">
</head>
<body>
    <div class="app-container">
        <!-- å·¦ä¾§å¯¼èˆªæ  - ä¸dashboard.htmlç›¸åŒ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="../img/logo-sm.png" alt="Onerway Logo" class="sidebar-logo">
                <h3>å•†æˆ·ä¸­å¿ƒ</h3>
            </div>
            <ul class="sidebar-nav">
                <li class="sidebar-nav-item">
                    <a href="dashboard.html" class="sidebar-nav-link">
                        <i class="nav-icon">ğŸ“Š</i>
                        <span>æ§åˆ¶å°</span>
                    </a>
                    <!-- æ§åˆ¶å°å­èœå• -->
                    <ul class="sidebar-subnav">
                        <li class="sidebar-subnav-item">
                            <a href="manage-links.html" class="sidebar-subnav-link">ç®¡ç†é“¾æ¥</a>
                        </li>
                    </ul>
                </li>
                <!-- è®¢é˜…åŠŸèƒ½å¯¼èˆªå…¥å£ -->
                <li class="sidebar-nav-item active">
                    <a href="subscription-links.html" class="sidebar-nav-link">
                        <i class="nav-icon">ğŸ”„</i>
                        <span>è®¢é˜…ç®¡ç†</span>
                    </a>
                    <!-- è®¢é˜…ç®¡ç†å­èœå• -->
                    <ul class="sidebar-subnav">
                        <li class="sidebar-subnav-item active">
                            <a href="subscription-links.html" class="sidebar-subnav-link">è®¢é˜…é“¾æ¥</a>
                        </li>
                    </ul>
                </li>
                <li class="sidebar-nav-item">
                    <a href="#" class="sidebar-nav-link">
                        <i class="nav-icon">âš™ï¸</i>
                        <span>è®¾ç½®</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div id="subscription-container">
                <div class="subscription-module">
                    <div class="module-header">
                        <h2>è®¢é˜…é“¾æ¥</h2>
                        <a href="subscription-create.html" class="pure-button primary-button">åˆ›å»ºè®¢é˜…é“¾æ¥</a>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <table class="pure-table pure-table-bordered" id="subscription-links-table">
                                <thead>
                                    <tr>
                                        <th>å•†å“å</th>
                                        <th>é‡‘é¢</th>
                                        <th>æ‰£æ¬¾é¢‘ç‡</th>
                                        <th>åˆ›å»ºæ—¶é—´</th>
                                        <th>çŠ¶æ€</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="6" class="text-center">åŠ è½½ä¸­...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/modules/subscription-core.js"></script>
    <script src="../js/navigation.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½è®¢é˜…é“¾æ¥æ•°æ®
            loadSubscriptionLinks();
        });
        
        function loadSubscriptionLinks() {
            const links = SubscriptionCore.getAllSubscriptionLinks();
            
            const tableBody = document.querySelector('#subscription-links-table tbody');
            
            if (links.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">æš‚æ— è®¢é˜…é“¾æ¥</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            links.forEach(link => {
                let statusText = link.status === 'active' ? 'å¯ç”¨' : 'åœç”¨';
                let statusClass = link.status === 'active' ? 'badge-success' : 'badge-secondary';
                
                // æ ¼å¼åŒ–æ‰£æ¬¾å‘¨æœŸ
                let frequencyText;
                switch(link.billingFrequency) {
                    case 'daily': frequencyText = 'æ¯å¤©'; break;
                    case 'weekly': frequencyText = 'æ¯å‘¨'; break;
                    case 'monthly': frequencyText = 'æ¯æœˆ'; break;
                    default: frequencyText = link.billingFrequency;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${link.title}</td>
                    <td>${formatAmount(link.amount, link.currency)}</td>
                    <td>${frequencyText}</td>
                    <td>${formatDate(link.createdAt)}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <a href="subscription-details.html?id=${link.id}" class="pure-button secondary-button">æŸ¥çœ‹è¯¦æƒ…</a>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleString('zh-CN');
        }
        
        // æ ¼å¼åŒ–é‡‘é¢
        function formatAmount(amount, currency) {
            return new Intl.NumberFormat('zh-CN', { 
                style: 'currency', 
                currency: currency 
            }).format(amount);
        }
    </script>
</body>
</html> 
# Onerway 订阅链接功能规格

## 1. 功能概述

订阅链接功能允许商户创建定期付款的收款方式，用户可以通过链接订阅商户的产品或服务，系统会根据设定的周期自动向用户收取费用。

## 2. 商户功能

### 2.1 订阅链接管理

#### 2.1.1 创建订阅页面 (CreateSubscriptionLink)
- **商品信息**
  - 选择商品
    - 选择已有商品
  - 新增商品（弹窗）
    - 商品名
    - 价格
    - 币种
    - 商品描述（可选）
    - 图片（可选）
    - 价格说明（可选，只对商户展示）
- **订阅选项**
  - 订阅周期
    - 1天
    - 7天
    - 30天
  - 期数选择
    - 1期
    - 3期
    - 6期
    - 12期
    - 永远
  - 添加试用天数
- **账单选项**
  - 收集客户地址（可选）
    - 仅账单地址
    - 账单地址和配送地址
  - 要求用户提供手机号（可选）
  - 选择付款方式
    - 自动扣款（默认全选）
      - 填写卡信息自动扣款
      - Google Pay 自动扣款
      - Apple Pay 自动扣款
- **高级选项 - 账单设置**（待做）
  - 订阅描述（可选）
  - 账单页脚（可选）

#### 2.1.2 订阅链接列表 (SubscriptionLinksList)
- 链接
- 商品名
- 金额（包含价格和币种）
- 扣款频率
- 创建时间

#### 2.1.3 订阅链接详情 (SubscriptionLinkDetails)
- **基础字段**
  - 商品名
  - 金额
  - 状态
    - 启用
    - 停用
      - 停用时间
  - 扣款频率
  - 扣款方式
    - 自动
    - 商家扣款
  - 订阅周期
  - 期数
  - 试用天数
  - 图片
  - 描述
- **统计字段**
  - 已支付笔数
  - 已收取金额
  - 已订阅用户数
- **交易流水字段**
  - 订阅合同号
  - 开始日期
  - 到期日期
  - 用户邮箱
  - 状态
    - 生效中
    - 待扣款

#### 2.1.4 查看单笔订阅页面 (SubscriptionInstanceDetails)
- **订阅基础字段**
  - 订阅状态
  - 订阅编号
  - 下次扣款时间
  - 下次扣款金额
  - 时效
- **订阅详情字段**
  - 扣款方式
  - 试用结束于
  - 产品名称
  - 开始日期
  - 产品单价
  - 到期日期
  - 产品数量
  - 扣款期数
  - 扣款金额
  - 扣款频率
- **顾客信息**
  - 客户ID
  - 用户邮箱
  - 支付方式
    - 卡支付
    - 钱包支付
- **扣款历史**
  - 交易流水号
  - 扣款时间
  - 金额
  - 状态

### 2.2 交易管理

#### 2.2.1 订阅交易列表 (SubscriptionTransactionsList)
- 查看所有订阅相关交易
- 高级筛选（按订阅链接、状态、日期、金额）
- 导出交易数据

## 3. 客户功能

### 3.1 订阅流程

#### 3.1.1 用户订阅页面 (SubscriptionPage)
- **商品信息**
  - 商品名
  - 数量
  - 金额
- **订阅信息**
  - 订阅时间
  - 到期时间
  - 订阅内容
- **支付信息**
  - 付款方式选择
  - 个人信息输入
  - 确认订阅条款

## 4. 系统功能

### 4.1 自动计费系统 (AutoBillingSystem)
- 定期扣款处理
- 付款失败重试机制
- 付款通知和提醒

### 4.2 报表与分析 (ReportsAndAnalytics)
- 订阅收入分析
- 续订率跟踪
- 用户流失分析

## 5. 数据结构

### 5.1 订阅链接 (SubscriptionLink)
```json
{
  "id": "sub_link_xxxxx",
  "merchantId": "merchant_xxxx",
  "title": "高级会员订阅",
  "description": "获取所有高级功能的访问权限",
  "imageUrl": "https://example.com/image.jpg",
  "amount": 19.99,
  "currency": "USD",
  "billingFrequency": "monthly", // daily, weekly, monthly
  "totalBillingCycles": 12, // 或 "unlimited"
  "trialDays": 7,
  "paymentMethod": "automatic", // automatic, manual
  "addressCollection": "billing_only", // none, billing_only, billing_and_shipping
  "requirePhone": true,
  "status": "active",
  "createdAt": "2023-06-01T00:00:00Z",
  "disabledAt": null
}
```

### 5.2 订阅实例 (SubscriptionInstance)
```json
{
  "id": "sub_inst_xxxxx",
  "subscriptionLinkId": "sub_link_xxxxx",
  "customerId": "cus_xxxxx",
  "customerEmail": "user@example.com",
  "status": "active", // active, pending_payment, cancelled, completed
  "startDate": "2023-06-01T00:00:00Z",
  "endDate": "2024-06-01T00:00:00Z",
  "trialEndsAt": "2023-06-08T00:00:00Z",
  "nextBillingDate": "2023-07-01T00:00:00Z",
  "nextBillingAmount": 19.99,
  "productName": "高级会员",
  "productQuantity": 1,
  "productUnitPrice": 19.99,
  "totalAmount": 19.99,
  "currency": "USD",
  "billingCycles": 12,
  "currentCycle": 1,
  "billingFrequency": "monthly",
  "paymentMethod": "card", // card, google_pay, apple_pay
  "createdAt": "2023-06-01T00:00:00Z",
  "updatedAt": "2023-06-01T00:00:00Z"
}
```

### 5.3 订阅交易 (SubscriptionTransaction)
```json
{
  "id": "sub_txn_xxxxx",
  "subscriptionInstanceId": "sub_inst_xxxxx",
  "amount": 19.99,
  "currency": "USD",
  "status": "succeeded", // succeeded, failed, pending
  "paymentMethod": "card",
  "transactionDate": "2023-06-01T00:00:00Z",
  "billingCycle": 1
}
```

## 6. 业务流程

### 6.1 创建订阅链接流程
1. 商户选择或创建商品
2. 设置订阅周期和期数
3. 配置试用期和账单选项
4. 预览订阅页面
5. 确认并发布链接

### 6.2 用户订阅流程
1. 用户访问订阅链接
2. 查看商品和订阅信息
3. 填写个人信息和付款方式
4. 确认订阅详情和条款
5. 完成首次付款
6. 系统创建订阅实例

### 6.3 定期扣款流程
1. 系统识别即将到期的订阅
2. 按计划执行自动扣款
3. 更新订阅状态和下次扣款日期
4. 记录交易历史
5. 处理付款失败情况
